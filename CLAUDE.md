# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

**hyperterm** is a unified text rendering library for terminal and web. It provides a monospace grid abstraction that can be rendered to both ANSI terminal output and HTML, enabling consistent styled text rendering across different output targets.

## Core Architecture

The project is built around a central grid abstraction with pluggable renderers:

### 1. Grid System (`MonospaceGrid`)
- **Location**: `proto.py:80-146`
- **Purpose**: Core data structure holding characters and their styles in a 2D grid
- Coordinates are `(x, y)` where `x` is column, `y` is row, and `(0, 0)` is top-left
- Stores two parallel 2D arrays: `chars` for characters and `styles` for style objects
- Provides drawing primitives: `set_char()`, `set_style()`, `draw_text()`, `draw_box()`

### 2. Style System
- **Style class**: `proto.py:57-76`
- Each grid cell has an associated `Style` object with properties:
  - `fg_color`: foreground color name (e.g., 'red', 'green', 'blue')
  - `bg_color`: background color name
  - `bold`: boolean for bold text
  - `underline`: boolean for underlined text
- **Color mappings**: `proto.py:35-53`
  - `COLOR_MAP` and `BG_COLOR_MAP` define mappings from color names to both ANSI codes and HTML color values
  - This dual mapping enables consistent colors across terminal and web

### 3. Renderer Pattern
The library uses separate renderer classes for different output targets:

**TerminalRenderer** (`proto.py:150-206`)
- Converts `MonospaceGrid` to ANSI escape code strings
- Optimizes output by tracking style changes and only emitting ANSI codes when styles differ
- Resets style at end of each row for safety

**HTMLRenderer** (`proto.py:211-291`)
- Converts `MonospaceGrid` to HTML with inline CSS
- Uses `<span>` tags with inline styles for styled regions
- Wraps output in `<pre>` tag with retro terminal aesthetic (monospace font, border, glow effect)
- HTML-escapes special characters (`&`, `<`, `>`)

### 4. Project Structure
- `proto.py`: Full prototype implementation generated by Gemini (indicated in file header)
- `main.py`: Simple entry point stub
- `hyperterm/__init__.py`: Package initialization (currently empty)
- `pyproject.toml`: Python project configuration (requires Python >=3.9, no dependencies yet)

## Development Commands

### Running the Prototype Demo
```bash
python proto.py
```
This demonstrates the grid system by creating a styled "SYSTEM STATUS" display and rendering it to both terminal (ANSI) and HTML.

### Running the Main Entry Point
```bash
python main.py
```

### Installing in Development Mode
```bash
pip install -e .
```

## Key Design Patterns

1. **Separation of Concerns**: The grid abstraction is completely independent of rendering. Renderers operate on the grid without modifying it.

2. **Style State Tracking**: Both renderers track the "current" style and only emit style changes when necessary, optimizing output size.

3. **Dual Output Strategy**: Color and style information is stored in a target-agnostic way via the mapping dictionaries, allowing consistent rendering across outputs.

## Notes for Implementation

- The current code in `proto.py` is explicitly marked as a prototype to use as a starting point
- The actual implementation should likely be moved into the `hyperterm/` package directory
- No external dependencies are currently defined, but the prototype notes that Windows users may need `colorama` for ANSI support
